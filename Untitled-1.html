<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="æ–°å¹´çƒŸèŠ±ç‰¹æ•ˆ - å¾®ä¿¡å¯ç›´æ¥æ‰“å¼€">
    <title>ğŸ† æ–°å¹´çƒŸèŠ± | å¾®ä¿¡ç›´æ¥è§‚çœ‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background-color: #000;
            overflow: hidden;
            font-family: 'Microsoft YaHei', 'Segoe UI', sans-serif;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            touch-action: manipulation;
        }
        
        #fireworksCanvas {
            display: block;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 1;
        }
        
        .new-year-text {
            position: fixed;
            top: 15%;
            left: 50%;
            transform: translateX(-50%);
            color: #FFD700;
            font-size: min(12vw, 72px);
            font-weight: bold;
            text-align: center;
            text-shadow: 
                0 0 10px #FF0000,
                0 0 20px #FF4500,
                0 0 30px #FF8C00;
            z-index: 2;
            white-space: nowrap;
            animation: textGlow 1.5s ease-in-out infinite alternate;
            padding: 10px 20px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(5px);
        }
        
        @keyframes textGlow {
            0% {
                text-shadow: 
                    0 0 10px #FF0000,
                    0 0 20px #FF4500;
                transform: translateX(-50%) scale(1);
            }
            100% {
                text-shadow: 
                    0 0 20px #FF0000,
                    0 0 30px #FF4500,
                    0 0 40px #FF8C00;
                transform: translateX(-50%) scale(1.05);
            }
        }
        
        .instructions {
            position: fixed;
            bottom: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: min(4vw, 16px);
            z-index: 2;
            padding: 0 20px;
        }
        
        .fireworks-count {
            position: fixed;
            top: 20px;
            right: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px 10px;
            border-radius: 10px;
            z-index: 2;
        }
        
        .tap-hint {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: rgba(255, 255, 255, 0.5);
            font-size: min(5vw, 20px);
            text-align: center;
            animation: fadeHint 3s ease-in-out infinite;
            z-index: 2;
        }
        
        @keyframes fadeHint {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.7; }
        }
        
        /* é€‚é…æ·±è‰²æ¨¡å¼ */
        @media (prefers-color-scheme: dark) {
            body {
                background: #000;
            }
        }
        
        /* æ¨ªå±é€‚é… */
        @media (orientation: landscape) {
            .new-year-text {
                top: 10%;
                font-size: min(8vh, 60px);
            }
        }
    </style>
</head>
<body>
    <canvas id="fireworksCanvas"></canvas>
    <div class="new-year-text">ğŸ‰ æ–°å¹´å¿«ä¹ ğŸ‰</div>
    <div class="tap-hint">ç‚¹å‡»å±å¹•æ·»åŠ çƒŸèŠ±</div>
    <div class="fireworks-count">çƒŸèŠ±: <span id="count">0</span></div>
    <div class="instructions">åœ¨å¾®ä¿¡ä¸­æ‰“å¼€ | è‡ªåŠ¨é€‚é…æ‰‹æœºå±å¹•</div>

    <script>
        // çƒŸèŠ±ç‰¹æ•ˆæ ¸å¿ƒä»£ç 
        (function() {
            'use strict';
            
            // è·å–Canvaså…ƒç´ 
            const canvas = document.getElementById('fireworksCanvas');
            const ctx = canvas.getContext('2d');
            const fireworksCountElement = document.getElementById('count');
            
            let fireworks = [];
            let particles = [];
            let animationId = null;
            let fireworksCount = 0;
            
            // åˆå§‹åŒ–Canvaså°ºå¯¸
            function initCanvas() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                console.log(`Canvaså°ºå¯¸: ${canvas.width} x ${canvas.height}`);
            }
            
            // éšæœºå·¥å…·å‡½æ•°
            function random(min, max) {
                return Math.random() * (max - min) + min;
            }
            
            // éšæœºé¢œè‰²ç”Ÿæˆ
            function randomColor() {
                const hue = Math.floor(random(0, 360));
                const saturation = random(80, 100);
                const lightness = random(50, 70);
                return `hsl(${hue}, ${saturation}%, ${lightness}%)`;
            }
            
            // ç²’å­ç±»
            class Particle {
                constructor(x, y, color, isTrail = false) {
                    this.x = x;
                    this.y = y;
                    this.color = color;
                    this.size = isTrail ? random(1, 2) : random(2, 4);
                    this.speed = {
                        x: random(-8, 8),
                        y: random(-8, 8)
                    };
                    this.gravity = 0.1;
                    this.friction = 0.97;
                    this.alpha = 1;
                    this.decay = random(0.005, 0.02);
                    this.isTrail = isTrail;
                }
                
                update() {
                    this.speed.x *= this.friction;
                    this.speed.y *= this.friction;
                    
                    if (!this.isTrail) {
                        this.speed.y += this.gravity;
                    }
                    
                    this.x += this.speed.x;
                    this.y += this.speed.y;
                    this.alpha -= this.decay;
                    this.size *= 0.99;
                }
                
                draw() {
                    if (this.alpha <= 0) return;
                    
                    ctx.globalAlpha = this.alpha;
                    ctx.fillStyle = this.color;
                    ctx.beginPath();
                    
                    if (this.isTrail) {
                        // æ‹–å°¾æ•ˆæœ - ç»˜åˆ¶å°åœ†ç‚¹
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                    } else {
                        // çˆ†ç‚¸ç²’å­ - ç»˜åˆ¶æ˜Ÿå½¢
                        const spikes = 5;
                        const outerRadius = this.size;
                        const innerRadius = this.size * 0.5;
                        
                        for (let i = 0; i < spikes * 2; i++) {
                            const radius = i % 2 === 0 ? outerRadius : innerRadius;
                            const angle = (Math.PI * i) / spikes;
                            const px = this.x + Math.cos(angle) * radius;
                            const py = this.y + Math.sin(angle) * radius;
                            
                            if (i === 0) {
                                ctx.moveTo(px, py);
                            } else {
                                ctx.lineTo(px, py);
                            }
                        }
                        ctx.closePath();
                    }
                    
                    ctx.fill();
                }
            }
            
            // çƒŸèŠ±ç±»
            class Firework {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.startY = canvas.height;
                    this.speed = {
                        x: random(-2, 2),
                        y: -random(12, 18)
                    };
                    this.gravity = 0.2;
                    this.color = randomColor();
                    this.trail = [];
                    this.exploded = false;
                    this.particles = [];
                    this.explosionSize = random(80, 150);
                    this.particleCount = Math.floor(random(80, 150));
                }
                
                update() {
                    if (!this.exploded) {
                        // æ·»åŠ æ‹–å°¾ç²’å­
                        this.trail.push(new Particle(this.x, this.y, this.color, true));
                        
                        // æ›´æ–°ä½ç½®
                        this.speed.y += this.gravity;
                        this.x += this.speed.x;
                        this.y += this.speed.y;
                        
                        // æ¸…ç†æ—§æ‹–å°¾
                        if (this.trail.length > 15) {
                            this.trail.shift();
                        }
                        
                        // æ£€æŸ¥æ˜¯å¦éœ€è¦çˆ†ç‚¸
                        if (this.speed.y >= 0 || this.y < this.explosionSize) {
                            this.explode();
                        }
                    }
                    
                    // æ›´æ–°æ‹–å°¾
                    for (let i = this.trail.length - 1; i >= 0; i--) {
                        this.trail[i].update();
                        if (this.trail[i].alpha <= 0) {
                            this.trail.splice(i, 1);
                        }
                    }
                    
                    // æ›´æ–°çˆ†ç‚¸ç²’å­
                    for (let i = this.particles.length - 1; i >= 0; i--) {
                        this.particles[i].update();
                        if (this.particles[i].alpha <= 0) {
                            this.particles.splice(i, 1);
                        }
                    }
                }
                
                explode() {
                    this.exploded = true;
                    fireworksCount++;
                    fireworksCountElement.textContent = fireworksCount;
                    
                    // åˆ›å»ºçˆ†ç‚¸é—ªå…‰
                    ctx.globalAlpha = 0.8;
                    ctx.fillStyle = '#fff';
                    ctx.beginPath();
                    ctx.arc(this.x, this.y, 25, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // åˆ›å»ºçˆ†ç‚¸ç²’å­
                    for (let i = 0; i < this.particleCount; i++) {
                        const angle = random(0, Math.PI * 2);
                        const speed = random(2, 6);
                        const color = random(0, 100) > 70 ? 
                            randomColor() : 
                            this.color;
                        
                        const particle = new Particle(this.x, this.y, color);
                        particle.speed = {
                            x: Math.cos(angle) * speed,
                            y: Math.sin(angle) * speed
                        };
                        this.particles.push(particle);
                    }
                }
                
                draw() {
                    // ç»˜åˆ¶æ‹–å°¾
                    this.trail.forEach(particle => particle.draw());
                    
                    // ç»˜åˆ¶çƒŸèŠ±ä¸»ä½“ï¼ˆå¦‚æœæœªçˆ†ç‚¸ï¼‰
                    if (!this.exploded) {
                        ctx.globalAlpha = 1;
                        ctx.fillStyle = this.color;
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, 3, 0, Math.PI * 2);
                        ctx.fill();
                    }
                    
                    // ç»˜åˆ¶çˆ†ç‚¸ç²’å­
                    this.particles.forEach(particle => particle.draw());
                }
                
                isFinished() {
                    return this.exploded && this.particles.length === 0;
                }
            }
            
            // åˆ›å»ºæ–°çƒŸèŠ±
            function createFirework(x, y) {
                const firework = new Firework(x, y);
                fireworks.push(firework);
            }
            
            // è‡ªåŠ¨ç”ŸæˆçƒŸèŠ±
            function autoGenerateFireworks() {
                if (fireworks.length < 8 && random(0, 1) < 0.03) {
                    createFirework(random(50, canvas.width - 50), canvas.height);
                }
            }
            
            // åŠ¨ç”»å¾ªç¯
            function animate() {
                // æ¸…ç©ºç”»å¸ƒï¼ˆä½¿ç”¨åŠé€æ˜é»‘è‰²åˆ›å»ºæ‹–å°¾æ•ˆæœï¼‰
                ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // è‡ªåŠ¨ç”ŸæˆçƒŸèŠ±
                autoGenerateFireworks();
                
                // æ›´æ–°å’Œç»˜åˆ¶æ‰€æœ‰çƒŸèŠ±
                for (let i = fireworks.length - 1; i >= 0; i--) {
                    fireworks[i].update();
                    fireworks[i].draw();
                    
                    // ç§»é™¤å·²å®Œæˆçš„çƒŸèŠ±
                    if (fireworks[i].isFinished()) {
                        fireworks.splice(i, 1);
                    }
                }
                
                // ç»§ç»­åŠ¨ç”»
                animationId = requestAnimationFrame(animate);
            }
            
            // äº‹ä»¶ç›‘å¬å™¨
            function setupEventListeners() {
                // çª—å£å¤§å°æ”¹å˜
                window.addEventListener('resize', () => {
                    initCanvas();
                });
                
                // ç‚¹å‡»æ·»åŠ çƒŸèŠ±
                canvas.addEventListener('click', (e) => {
                    createFirework(e.clientX, e.clientY);
                });
                
                // è§¦æ‘¸äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
                canvas.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    const touch = e.touches[0];
                    createFirework(touch.clientX, touch.clientY);
                }, { passive: false });
                
                // é”®ç›˜æ§åˆ¶ï¼ˆç©ºæ ¼é”®æ·»åŠ çƒŸèŠ±ï¼‰
                window.addEventListener('keydown', (e) => {
                    if (e.code === 'Space') {
                        e.preventDefault();
                        createFirework(random(100, canvas.width - 100), canvas.height);
                    }
                });
                
                // é˜²æ­¢é¡µé¢æ»šåŠ¨
                document.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false });
            }
            
            // åˆå§‹åŒ–
            function init() {
                console.log('ğŸ† çƒŸèŠ±ç‰¹æ•ˆåˆå§‹åŒ–...');
                initCanvas();
                setupEventListeners();
                
                // åˆ›å»ºåˆå§‹çƒŸèŠ±
                setTimeout(() => createFirework(canvas.width * 0.3, canvas.height), 500);
                setTimeout(() => createFirework(canvas.width * 0.7, canvas.height), 1000);
                setTimeout(() => createFirework(canvas.width * 0.5, canvas.height), 1500);
                
                // å¼€å§‹åŠ¨ç”»
                animate();
                console.log('âœ… çƒŸèŠ±ç‰¹æ•ˆå·²å¯åŠ¨ï¼');
            }
            
            // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
            
            // é¡µé¢éšè—æ—¶æš‚åœåŠ¨ç”»ä»¥èŠ‚çœèµ„æº
            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    if (animationId) {
                        cancelAnimationFrame(animationId);
                        animationId = null;
                    }
                } else if (!animationId) {
                    animate();
                }
            });
            
            // å¯¼å‡ºå‡½æ•°ä¾›è°ƒè¯•ä½¿ç”¨
            window.fireworksApp = {
                createFirework,
                getFireworksCount: () => fireworks.length,
                reset: () => {
                    fireworks = [];
                    fireworksCount = 0;
                    fireworksCountElement.textContent = '0';
                }
            };
            
        })();
    </script>
</body>
</html>